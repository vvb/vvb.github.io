
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Python and state of SSL/TLS — Servers | Containers | Management | Software</title>

    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" type="text/css" href="../assets/css/main.css?v=6b07db11f0">

<!-- For speed, I’ve added the response from this link straight into defer.css-->
<!--<link rel="stylesheet" href="//brick.a.ssl.fastly.net/Source+Serif+Pro:400,700/Source+Sans+Pro:400,900,400i,900i/Alegreya:400i,700i">-->

    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">
    <link rel="canonical" href="http://blog.vijayvikrant.com/python-and-state-of-ssl-tls/">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <link rel="amphtml" href="http://blog.vijayvikrant.com/python-and-state-of-ssl-tls/amp/">
    
    <meta property="og:site_name" content="Servers | Containers | Management | Software">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Python and state of SSL/TLS">
    <meta property="og:description" content="Python 2.7.9 introduces a ssl.SSLContext object to make selecting SSL version easier. Since using SSLv2 or SSLv3 is a crime, most systems rely on TLSv1, TLSv1.1 or TLSv1.2. The SSLContext obect makes it easier to define the generic subset of protocol one desires and then">
    <meta property="og:url" content="http://blog.vijayvikrant.com/python-and-state-of-ssl-tls/">
    <meta property="article:published_time" content="2016-11-23T15:37:47.000Z">
    <meta property="article:modified_time" content="2016-11-24T05:36:33.000Z">
    <meta property="article:tag" content="ucspython">
    <meta property="article:tag" content="ucsmsdk">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Python and state of SSL/TLS">
    <meta name="twitter:description" content="Python 2.7.9 introduces a ssl.SSLContext object to make selecting SSL version easier. Since using SSLv2 or SSLv3 is a crime, most systems rely on TLSv1, TLSv1.1 or TLSv1.2. The SSLContext obect makes it easier to define the generic subset of protocol one desires and then">
    <meta name="twitter:url" content="http://blog.vijayvikrant.com/python-and-state-of-ssl-tls/">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Vikrant Balyan">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="ucspython, ucsmsdk">
    <meta name="twitter:site" content="@vvb__">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Servers | Containers | Management | Software",
        "logo": {
            "@type": "ImageObject",
            "url": "http://blog.vijayvikrant.com/favicon.ico",
            "width": 16,
            "height": 16
        }
    },
    "author": {
        "@type": "Person",
        "name": "Vikrant Balyan",
        "url": "http://blog.vijayvikrant.com/author/vikrant/",
        "sameAs": []
    },
    "headline": "Python and state of SSL/TLS",
    "url": "http://blog.vijayvikrant.com/python-and-state-of-ssl-tls/",
    "datePublished": "2016-11-23T15:37:47.000Z",
    "dateModified": "2016-11-24T05:36:33.000Z",
    "keywords": "ucspython, ucsmsdk",
    "description": "Python 2.7.9 introduces a ssl.SSLContext object to make selecting SSL version easier. Since using SSLv2 or SSLv3 is a crime, most systems rely on TLSv1, TLSv1.1 or TLSv1.2. The SSLContext obect makes it easier to define the generic subset of protocol one desires and then",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://blog.vijayvikrant.com/"
    }
}
    </script>

    <meta name="generator" content="Ghost 2.6">
    <link rel="alternate" type="application/rss+xml" title="Servers | Containers | Management | Software" href="http://blog.vijayvikrant.com/rss/">
    <script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-6134465745215709",
    enable_page_level_ads: true
  });
</script>
</head>
<body class="post-template tag-ucspython tag-ucsmsdk" id="body">

    

<div class="main-header--content main-nav--content clearfix">
  <a href="http://blog.vijayvikrant.com">
    <h3><span class="back-arrow">← </span>Servers | Containers | Management | Software</h3>
  </a>
</div>

<main class="content">

    <article class="post tag-ucspython tag-ucsmsdk">

        <header class="post-header">
            <h1 class="post-title typl8-gamma">Python and state of SSL/TLS</h1>
            <section class="post-meta">
                By <a href="../author/vikrant/">Vikrant Balyan</a>
                <time class="post-date" datetime="2016-11-23"> Nov 23rd 2016</time>
                <span class="post-tags">Tags: <a href="../tag/ucspython/">ucspython</a>, <a href="../tag/ucsmsdk/">ucsmsdk</a></span>
            </section>
        </header>

        <section class="post-content">
            <p>Python 2.7.9 introduces a <code>ssl.SSLContext</code> object to make selecting SSL version easier.</p>
<p>Since using SSLv2 or SSLv3 is a crime, most systems rely on TLSv1, TLSv1.1 or TLSv1.2. The SSLContext obect makes it easier to define the generic subset of protocol one desires and then individually turnoff some of them.</p>
<p>The below code relies only on TLSv1, TLSv1.1, TLSv1.2 and not use SSLv2 or SSLv3</p>
<pre><code>ssl_context = ssl.SSLContext(ssl.PROTOCOL_SSLv23)
ssl_context.options |= ssl.OP_NO_SSLv2
ssl_context.options |= ssl.OP_NO_SSLv3
</code></pre>
<p>So, How can this be used in the larger context.<br>
We use <code>urllib2</code> and so the above needs to fit into one of the handlers.</p>
<pre><code>opener = urllib2.build_opener(TLSHandler)
response = opener.open(url)

class TLSHandler(urllib2.HTTPSHandler):                                         
    """Like HTTPSHandler but more specific"""                                   
                                                                                
    def __init__(self):                                                         
    ¦   urllib2.HTTPSHandler.__init__(self)                                     
                                                                                
    def https_open(self, req):                                                  
    ¦   return self.do_open(TLSConnection, req) 

class TLSConnection(httplib.HTTPSConnection):                                   
    """Like HTTPSConnection but more specific"""                                
                                                                                
    def __init__(self, host, **kwargs):                                         
    ¦   httplib.HTTPSConnection.__init__(self, host, **kwargs)                  
                                                                                
    def connect(self):                                                          
    ¦   """Overrides HTTPSConnection.connect to specify TLS version"""          
    ¦   # Standard implementation from HTTPSConnection, which is not            
    ¦   # designed for extension, unfortunately                                 
    ¦   sock = socket.create_connection((self.host, self.port),             
    ¦   ¦   ¦   self.timeout, self.source_address)  
                                                                                            
    ¦   if getattr(self, '_tunnel_host', None):                                 
    ¦   ¦   self.sock = sock                                                    
    ¦   ¦   self._tunnel()                                                      
                                                                                
    ¦   # Since python 2.7.9, tls 1.1 and 1.2 are supported via 
    ¦   # SSLContext                                                        
    ¦   ssl_context = ssl.SSLContext(ssl.PROTOCOL_SSLv23)                   
    ¦   ssl_context.options |= ssl.OP_NO_SSLv2                              
    ¦   ssl_context.options |= ssl.OP_NO_SSLv3                              
    ¦   ssl_context.load_cert_chain(keyfile, certfile)            
    ¦   self.sock = ssl_context.wrap_socket(sock)  
</code></pre>
<p>This would produce a <code>SSL_UNSUPPORTED_VERSION</code> error when the server does not support TLSv1/1.1/1.2</p>
<p>note: TLSv1.1 and TLSv1.2 are supported only since Openssl version 1.0.1. And so, you might have Python &gt;= 2.7.9 and still not see <code>PROTOCOL_TLSv1_1</code> and <code>PROTOCOL_TLSv1_2</code> unless the openssl version is correct.</p>
<p>TLS 1.2 handshake fails in some clients, because of a TLV length padding issue. In such cases, we should fallback to TLSv1.</p>

        </section>

        <footer class="post-footer">



            <section class="author">
                <h4><a href="../author/vikrant/">Vikrant Balyan</a></h4>

                    <p>Read <a href="../author/vikrant/">more posts</a> by this author.</p>
                <div class="author-meta">
                    
                    
                    
                    
                </div>
            </section>


            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="https://twitter.com/share?text=Python%20and%20state%20of%20SSL%2FTLS&amp;url=http://blog.vijayvikrant.com/python-and-state-of-ssl-tls/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.vijayvikrant.com/python-and-state-of-ssl-tls/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=http://blog.vijayvikrant.com/python-and-state-of-ssl-tls/" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>

        </footer>
    <!--
    If you want Disqus comments, uncomment this. Make sure to set your disqus shortname in partials/comments.hbs first!
     -->
    </article>
</main>


    <footer class="site-footer">
      <a class="subscribe icon-feed" href="http://blog.vijayvikrant.com/rss/">
       <span class="tooltip">Subscribe!</span>
      </a>
<!--  Uncomment if you want a copy of your navigation in the footer. It’s pretty cool, and gives your visitors something to do when they finish an article other than commenting, sharing, or closing the tab.    -->
      <nav>
        <ul class="nav">
    <li class="nav-home" role="presentation">
      <a href="http://blog.vijayvikrant.com">Home</a>
    </li>
      <li class="nav-https://twitter.com/vvb__" role="presentation">
        <a href="https://twitter.com/vvb__"><span class="icon-twitter"></span></a>
      </li>
</ul>

      </nav>
      <div>
        <span class="print-data copyright-notice">
          © 2018
          <a href="http://blog.vijayvikrant.com/">Servers | Containers | Management | Software</a>
           • 
        </span>

        <span>

          <a href="http://github.com/curiositry/mnml-ghost-theme">mnml</a>
          theme by
          <a href="http://curiositry.github.io">Curiositry</a>
        </span>

        <span>
          • 
         Proudly published with
          <a href="https://ghost.org"><span class="icon-ghost typl8-zeta"></span><span class="hidden">Ghost</span></a>             </span>
      </div>
    </footer>

    <!--
    This generates a handsome modal menu and hamburger icon. If you want to use it, edit     menu.hbs and add your links (line ~146), then remove the ! from this helper to           activate it.
    -->
      <!--
THE MENU: Enabling this partial creates a hamburger icon that opens a menu. It’s responsive, lightweight, and works with javascript disabled.
-->


<!-- Trigger element, which is hidden -->
<input type="checkbox" id="menu-trigger">

<!-- Thus label which control the trigger. The hamburger icon is a background image in      the CSS (base64 encoded svg) in main.css. Hover and close states in defer.css-->
<label for="menu-trigger" id="open-menu" class="open-menu btn"></label>

<!-- The menu that slides in. Styles in defer.css -->
<nav class="menu" id="menu">
  <ul class="nav">
    <li class="nav-home" role="presentation">
      <a href="http://blog.vijayvikrant.com">Home</a>
    </li>
      <li class="nav-https://twitter.com/vvb__" role="presentation">
        <a href="https://twitter.com/vvb__"><span class="icon-twitter"></span></a>
      </li>
</ul>

</nav>

<!--
This makes the rest of the page move down with the menu for style points, but is              optional. The menu works fine with pure css.
-->
<script>
  var navTrigger = document.getElementById("menu-trigger");
  var menu = document.getElementById("menu");
  var bodyTag = document.getElementsByTagName("body")[0];


navTrigger.onclick = function () {
  if(navTrigger.checked){
    bodyTag.classList.add("menu-transition");
    document.getElementsByTagName("body")[0].style.marginTop = menu.clientHeight+"px";
  }else{
    bodyTag.classList.add("menu-transition");
    document.getElementsByTagName("body")[0].style.marginTop = "0";
  }
}
</script>


    <!-- Ghost outputs important scripts and data with this tag -->
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-78616097-1', 'auto');
  ga('send', 'pageview');

</script>

    <!--
    This loads katex.hbs in; if a page has anything with the class .math, katex.hbs           loads Khan Academy’s Tex math typesetting library and runs it on the content.

    If you don’t want to use KaTeX, comment this out.
    -->
    <script type="text/javascript">
var mathAreas = document.getElementsByClassName("math");
if (mathAreas){
  var ss = document.createElement("link");
  ss.type = "text/css";
  ss.rel = "stylesheet";
  ss.href = "//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.6.0/katex.min.css";
  document.getElementsByTagName("head")[0].appendChild(ss);

  var script = document.createElement( 'script' );
  script.type = 'text/javascript';
  script.src = '//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.6.0/katex.min.js';
  document.body.appendChild(script);

  window.onload = function() {
    Array.prototype.forEach.call(
      document.getElementsByClassName("math"),
      function(el) {
        try {
          katex.render(el.innerHTML, el, { displayMode: true });
        } catch (e) { console.log(e); }
      }
    );
  }
}
</script>

    <script>
      var cb = function() {
        var l = document.createElement('link'); l.rel = 'stylesheet';
        l.href = '/assets/css/defer.css?v=6b07db11f0';
        var h = document.getElementsByTagName('head')[0];
        h.parentNode.insertBefore(l, h);
      };
      var raf = requestAnimationFrame || mozRequestAnimationFrame ||
          webkitRequestAnimationFrame || msRequestAnimationFrame;
      if (raf) raf(cb);
      else window.addEventListener('load', cb);
    </script>

    <script async src="../assets/js/index.js?v=6b07db11f0"></script>
    <script defer src="../assets/js/prism.min.js?v=6b07db11f0"></script>

</body>
